<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WheelzAI - Your Advertisements</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: #1e293b;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 30px;
            border: 1px solid #e5e7eb;
        }

        .ads-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 24px;
            margin-top: 30px;
        }

        .ad-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .ad-card:hover {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
        }

        .ad-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border-radius: 12px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            font-size: 48px;
            position: relative;
            overflow: hidden;
        }

        .ad-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }

        .ad-title {
            font-size: 20px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .ad-price {
            font-size: 24px;
            font-weight: 800;
            color: #059669;
            margin-bottom: 12px;
        }

        .ad-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .ad-detail-item {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
        }

        .ad-detail-label {
            color: #64748b;
            font-weight: 500;
        }

        .ad-detail-value {
            color: #1e293b;
            font-weight: 600;
        }

        .ad-status {
            position: absolute;
            top: 16px;
            right: 16px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: #dcfce7;
            color: #166534;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-sold {
            background: #fee2e2;
            color: #991b1b;
        }

        .ad-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 14px;
            flex: 1;
            text-align: center;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3b82f6, #2563eb);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(45deg, #2563eb, #1d4ed8);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: white;
            color: #64748b;
            border: 1px solid #e5e7eb;
        }

        .btn-secondary:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }

        .btn-danger {
            background: linear-gradient(45deg, #ef4444, #dc2626);
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(45deg, #dc2626, #b91c1c);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 16px;
            border: 1px solid #e5e7eb;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
        }

        .empty-state-message {
            color: #64748b;
            font-size: 16px;
            margin-bottom: 24px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e5e7eb;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #3b82f6;
            margin-bottom: 4px;
        }

        .stat-label {
            color: #64748b;
            font-size: 14px;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #3b82f6;
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 20px;
            transition: color 0.3s ease;
        }

        .back-button:hover {
            color: #2563eb;
        }

        .filters {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .filter-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .filter-btn:hover {
            border-color: #3b82f6;
        }

        .search-box {
            width: 100%;
            max-width: 400px;
            padding: 12px 16px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .search-box:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Enhanced Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 800px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.25);
            animation: modalSlideIn 0.3s ease-out;
            position: relative;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.96);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            padding: 20px 20px 15px 20px;
            border-bottom: 1px solid #e5e7eb;
            position: sticky;
            top: 0;
            background: white;
            border-radius: 16px 16px 0 0;
            z-index: 10;
        }

        .modal-title {
            font-size: 22px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 6px;
            line-height: 1.2;
        }

        .modal-subtitle {
            color: #64748b;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.05);
            border: none;
            font-size: 20px;
            color: #64748b;
            cursor: pointer;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(0, 0, 0, 0.1);
            color: #1e293b;
            transform: scale(1.1);
        }

        .modal-body {
            padding: 20px;
        }

        /* Improved Image Gallery */
        .image-gallery-container {
            margin-bottom: 20px;
        }

        .main-image-container {
            position: relative;
            width: 100%;
            height: 280px;
            border-radius: 12px;
            overflow: hidden;
            background: #f8fafc;
            margin-bottom: 15px;
            box-shadow: 0 6px 20px -5px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .main-image {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            transition: transform 0.3s ease;
            border-radius: 8px;
        }

        .main-image:hover {
            transform: scale(1.02);
        }

        .main-image-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: #64748b;
            font-size: 64px;
        }

        .main-image-placeholder .text {
            font-size: 18px;
            margin-top: 16px;
            font-weight: 500;
        }

        .thumbnail-container {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 6px 0;
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 #f1f5f9;
        }

        .thumbnail-container::-webkit-scrollbar {
            height: 4px;
        }

        .thumbnail-container::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 2px;
        }

        .thumbnail-container::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 2px;
        }

        .thumbnail {
            flex-shrink: 0;
            width: 80px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            background: #f8fafc;
        }

        .thumbnail:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px -3px rgba(0, 0, 0, 0.15);
        }

        .thumbnail.active {
            border-color: #3b82f6;
            box-shadow: 0 0 0 1px #3b82f6;
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .thumbnail-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #94a3b8;
            font-size: 20px;
        }

        /* Enhanced Price Section */
        .price-section {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            padding: 18px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .price-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.1;
        }

        .price-main {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 6px;
            position: relative;
        }

        .price-estimate {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 6px;
            position: relative;
        }

        .price-negotiable {
            font-size: 12px;
            opacity: 0.8;
            position: relative;
        }

        /* Enhanced Details Grid */
        .details-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .detail-section {
            background: #f8fafc;
            padding: 18px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .detail-section h3 {
            font-size: 16px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            color: #64748b;
            font-weight: 500;
            font-size: 13px;
        }

        .detail-value {
            color: #1e293b;
            font-weight: 600;
            font-size: 13px;
            text-align: right;
        }

        /* Enhanced Contact Section */
        .contact-section {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border: 1px solid #bfdbfe;
            padding: 18px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .contact-section h3 {
            font-size: 16px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .contact-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .contact-info {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
        }

        .contact-label {
            font-weight: 600;
            color: #1e293b;
        }

        .contact-value {
            color: #64748b;
        }

        .contact-methods {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .contact-method {
            background: #3b82f6;
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
        }

        /* Additional Notes Section */
        .notes-section {
            background: #fafafa;
            padding: 18px;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            margin-top: 20px;
        }

        .notes-section h3 {
            font-size: 16px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .notes-text {
            color: #64748b;
            line-height: 1.5;
            font-size: 14px;
        }

        /* Chatbot Styles */
        .chatbot-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .chatbot-toggle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            position: relative;
        }

        .chatbot-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.2);
        }

        .chatbot-toggle svg {
            width: 28px;
            height: 28px;
            fill: white;
        }

        .chatbot-window {
            position: absolute;
            bottom: 80px;
            left: 0;
            width: 400px;
            height: 550px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            display: none;
            flex-direction: column;
            overflow: hidden;
            animation: slideUpLeft 0.3s ease;
        }

        .chatbot-window.active {
            display: flex;
        }

        @keyframes slideUpLeft {
            from {
                opacity: 0;
                transform: translateY(20px) translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0) translateX(0);
            }
        }

        .chatbot-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chatbot-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .chatbot-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 20px;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chatbot-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: #f8fafc;
        }

        .message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.5;
            animation: messageSlide 0.3s ease;
            word-wrap: break-word;
            white-space: pre-wrap;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.bot {
            background: white;
            color: #333;
            align-self: flex-start;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .message.user {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            align-self: flex-end;
        }

        .chatbot-input-area {
            padding: 20px;
            border-top: 1px solid #e2e8f0;
            background: white;
        }

        .chatbot-input-container {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .chatbot-input {
            flex: 1;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            padding: 12px 16px;
            font-size: 14px;
            resize: none;
            min-height: 20px;
            max-height: 100px;
            outline: none;
            transition: border-color 0.2s ease;
        }

        .chatbot-input:focus {
            border-color: #667eea;
        }

        .chatbot-send {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease;
        }

        .chatbot-send:hover {
            transform: scale(1.05);
        }

        .chatbot-send:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .chatbot-send svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 5px;
            padding: 12px 16px;
            background: white;
            border-radius: 18px;
            border: 1px solid #e2e8f0;
            max-width: 80px;
            align-self: flex-start;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #94a3b8;
            animation: typingBounce 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typingBounce {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        .quick-questions {
            margin: 15px 0;
            padding: 15px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .quick-questions-header {
            font-size: 13px;
            color: #475569;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .quick-question {
            background: white;
            border: 1px solid #d1d5db;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #374151;
            text-align: left;
            width: 100%;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            margin-bottom: 8px;
            display: block;
        }

        .quick-question:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
            transform: translateY(-1px);
        }

        .ai-badge {
            display: inline-block;
            background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            margin-left: 8px;
            font-weight: 500;
        }

        .gemini-badge {
            display: inline-block;
            background: linear-gradient(135deg, #4285f4 0%, #ea4335 50%, #fbbc04 100%);
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            margin-left: 8px;
            font-weight: 500;
        }

        .error-message-chatbot {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            margin: 5px 0;
        }

        .api-status {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            color: #0c4a6e;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            margin: 5px 0;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .modal-content {
                margin: 10px;
                max-width: calc(100vw - 20px);
                max-height: 90vh;
                border-radius: 12px;
            }

            .modal-header {
                padding: 15px 15px 12px 15px;
            }

            .modal-title {
                font-size: 20px;
            }

            .modal-body {
                padding: 15px;
            }

            .details-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .contact-grid {
                grid-template-columns: 1fr;
            }

            .main-image-container {
                height: 200px;
            }

            .price-main {
                font-size: 24px;
            }

            .chatbot-window {
                width: calc(100vw - 30px);
                height: 70vh;
                bottom: 80px;
                left: 0;
            }
        }

        @media (max-width: 480px) {
            .modal-content {
                max-height: 92vh;
            }

            .thumbnail-container {
                gap: 6px;
            }

            .thumbnail {
                width: 70px;
                height: 50px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" style="display: flex; justify-content: center; align-items: center; height: 100vh; flex-direction: column; position: fixed; top: 0; left: 0; width: 100%; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); z-index: 9999;">
        <div class="loading-spinner"></div>
        <p class="text-lg mt-4 text-gray-700">Loading your advertisements...</p>
    </div>

    <!-- Advertisements Content -->
    <div id="ads-content" class="container" style="display: none;">
        <!-- Header -->
        <div class="header">
            <a href="dashboard.html" class="back-button">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                Back to Dashboard
            </a>
            <h1 class="text-3xl font-bold text-gray-800">Your Advertisements</h1>
            <p class="text-gray-600 mt-2">Manage and track your vehicle listings</p>
        </div>

        <!-- Statistics -->
        <div class="stats-grid" id="stats-section">
            <div class="stat-card">
                <div class="stat-value" id="total-ads">0</div>
                <div class="stat-label">Total Ads</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="active-ads">0</div>
                <div class="stat-label">Active Ads</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="pending-ads">0</div>
                <div class="stat-label">Pending Approval</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="sold-ads">0</div>
                <div class="stat-label">Sold</div>
            </div>
        </div>

        <!-- Search and Filters -->
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; margin-bottom: 20px;">
            <input type="text" class="search-box" id="search-input" placeholder="Search your advertisements...">
            <a href="sell.html" class="btn btn-primary" style="text-decoration: none; display: inline-block;">
                + Post New Ad
            </a>
        </div>

        <div class="filters">
            <button class="filter-btn active" data-filter="all">All Ads</button>
            <button class="filter-btn" data-filter="active">Active</button>
            <button class="filter-btn" data-filter="pending">Pending</button>
            <button class="filter-btn" data-filter="sold">Sold</button>
        </div>

        <!-- Advertisements Grid -->
        <div id="ads-grid" class="ads-grid">
            <!-- Ads will be populated here -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="empty-state" style="display: none;">
            <div class="empty-state-icon">🚗</div>
            <div class="empty-state-title">No Advertisements Yet</div>
            <div class="empty-state-message">You haven't posted any vehicle advertisements yet. Start by posting your first ad!</div>
            <a href="sell.html" class="btn btn-primary" style="text-decoration: none; display: inline-block;">Post Your First Ad</a>
        </div>
    </div>

    <!-- Enhanced Vehicle Details Modal -->
    <div id="vehicle-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <button class="modal-close" onclick="closeModal()">&times;</button>
                <div class="modal-title" id="modal-title">Vehicle Details</div>
                <div class="modal-subtitle" id="modal-subtitle">
                    <span>📅</span>
                    <span>Complete vehicle information</span>
                </div>
            </div>
            <div class="modal-body">
                <div id="modal-content">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Chatbot Integration for Advertisements -->
    <div class="chatbot-container">
        <button class="chatbot-toggle" id="chatbotToggle">
            <svg viewBox="0 0 24 24">
                <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
            </svg>
        </button>
        
        <div class="chatbot-window" id="chatbotWindow">
            <div class="chatbot-header">
                <h3>WheelzAI Ads Assistant 🇱🇰</h3>
                <button class="chatbot-close" id="chatbotClose">&times;</button>
            </div>
            
            <div class="chatbot-messages" id="chatbotMessages">
                <!-- Messages will be added here dynamically -->
            </div>
            
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
            
            <div class="chatbot-input-area">
                <div class="chatbot-input-container">
                    <textarea 
                        class="chatbot-input" 
                        id="chatbotInput" 
                        placeholder="Ask about managing ads, pricing tips, or vehicle info..."
                        rows="1"
                    ></textarea>
                    <button class="chatbot-send" id="chatbotSend">
                        <svg viewBox="0 0 24 24">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getFirestore, collection, query, where, orderBy, getDocs, doc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAOamMqCPIzJurf85fjBleVmWffdscEslM",
            authDomain: "wheelzai.firebaseapp.com",
            projectId: "wheelzai",
            storageBucket: "wheelzai.firebasestorage.app",
            messagingSenderId: "132756052907",
            appId: "1:132756052907:web:b92dc998b4b5bee8d450ee",
            measurementId: "G-ECQJYZYK43"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Make Firebase functions globally available
        window.db = db;
        window.auth = auth;
        window.deleteDoc = deleteDoc;
        window.doc = doc;

        // Global variable to track current main image
        let currentMainImage = 0;

        // Enhanced WheelzAI Chatbot Class for Advertisements Page
        class EnhancedWheelzAIChatbot {
            constructor() {
                this.isOpen = false;
                this.messages = [];
                this.conversationHistory = [];
                this.hasShownWelcome = false;
                
                // Enable Gemini API with your key
                this.GEMINI_API_KEY = 'AIzaSyCLW0c2OF0frOyKJtNnRMDH7WrByySs2Ww';
                
                // Advertisement-specific predefined questions and answers
                this.predefinedQA = {
                    "How to post a new vehicle advertisement": "To post a new vehicle advertisement:\n\n✅ **Steps:**\n1. Click the '+ Post New Ad' button above\n2. Fill in vehicle details (make, model, year, etc.)\n3. Upload high-quality photos from multiple angles\n4. Set your asking price and negotiation preferences\n5. Add contact information and preferred contact methods\n6. Review and submit your listing\n\n💡 **Pro Tips:**\n• Use good lighting for photos\n• Include interior, exterior, and engine shots\n• Write detailed descriptions\n• Research market prices first\n• Be honest about vehicle condition",
                    
                    "How to improve my ad visibility and get more buyers": "To get more buyers for your vehicle ad:\n\n📈 **Boost Visibility:**\n• Upload 6-8 high-quality photos\n• Write detailed, honest descriptions\n• Set competitive pricing\n• Include keywords (hybrid, automatic, etc.)\n• Update your listing regularly\n\n💰 **Pricing Strategy:**\n• Research similar vehicles on WheelzAI\n• Use the AI price estimate as a guide\n• Price slightly above your minimum to allow negotiation\n• Consider market demand for your vehicle type\n\n📞 **Contact & Response:**\n• Respond to inquiries within 2-4 hours\n• Be professional and courteous\n• Provide additional photos if requested\n• Be flexible with viewing appointments",
                    
                    "Best practices for vehicle photography": "Professional vehicle photography tips:\n\n📸 **Photo Checklist (8-12 photos):**\n1. Front 3/4 angle (main photo)\n2. Rear 3/4 angle\n3. Both side profiles\n4. Interior dashboard and seats\n5. Engine bay\n6. Odometer reading\n7. Any damage or wear areas\n8. Wheels/tires condition\n\n🌅 **Photography Tips:**\n• Shoot during golden hour (early morning/evening)\n• Clean the vehicle thoroughly first\n• Use natural lighting when possible\n• Avoid harsh shadows\n• Take photos from eye level\n• Show the vehicle in context (nice background)\n• Ensure photos are sharp and well-composed\n\n❌ **Avoid:**\n• Blurry or dark photos\n• Cluttered backgrounds\n• Photos taken at night\n• Hiding vehicle defects",
                    
                    "How to price my vehicle competitively": "Smart vehicle pricing strategy:\n\n💡 **Research Methods:**\n• Check similar vehicles on WheelzAI\n• Use the AI price estimation tool\n• Consider vehicle condition honestly\n• Factor in current market demand\n• Check import duties for similar models\n\n🎯 **Pricing Guidelines:**\n• **Excellent condition:** Market price + 5-10%\n• **Good condition:** Market price ± 5%\n• **Fair condition:** Market price - 10-15%\n• **Poor condition:** Market price - 20%+\n\n📊 **Sri Lankan Market Factors:**\n• Popular brands (Toyota, Honda) hold value better\n• Hybrid vehicles command premium\n• Low mileage adds significant value\n• Service history documentation helps\n• Original parts vs aftermarket affects price\n\n💬 **Negotiation Buffer:**\n• Price 10-15% above your minimum\n• Mark as 'negotiable' to attract more buyers\n• Be prepared to justify your asking price",
                    
                    "How to manage and track my advertisements": "Advertisement management guide:\n\n📊 **Dashboard Overview:**\n• **Total Ads:** All your listings\n• **Active Ads:** Currently visible to buyers\n• **Pending:** Awaiting approval\n• **Sold:** Completed transactions\n\n🔍 **Filtering & Search:**\n• Use filters to view ads by status\n• Search by vehicle make/model\n• Sort by date posted or price\n\n✏️ **Managing Your Ads:**\n• **View Details:** See complete listing info\n• **Edit:** Update photos, price, or description\n• **Delete:** Remove listings permanently\n• **Mark as Sold:** Update status when sold\n\n📈 **Performance Tracking:**\n• Monitor views and inquiries\n• Update photos if getting low interest\n• Adjust pricing based on market response\n• Refresh listings weekly for better visibility",
                    
                    "Popular car brands and pricing in Sri Lanka": "Sri Lankan vehicle market overview:\n\n🏆 **Most Popular Brands:**\n1. **Toyota** - Best resale value, reliable\n2. **Honda** - Fuel efficient, good build quality\n3. **Nissan** - Affordable maintenance\n4. **Suzuki** - Budget-friendly options\n5. **Mitsubishi** - Good for SUVs\n\n💰 **Popular Models & Price Ranges:**\n• **Toyota Vitz:** LKR 5.5M - 6.5M\n• **Honda Fit:** LKR 5.8M - 6.8M\n• **Toyota Aqua:** LKR 6.5M - 8.5M\n• **Honda Grace:** LKR 7M - 9M\n• **Toyota Prius:** LKR 7M - 12M\n\n🔋 **Hybrid Premium:**\n• Hybrid vehicles sell 15-25% higher\n• Better fuel economy attracts buyers\n• Government tax benefits\n• Popular for city driving\n\n📍 **Regional Preferences:**\n• Colombo: Premium brands, hybrids\n• Suburban areas: Family cars, SUVs\n• Rural areas: Reliable, low-maintenance vehicles"
                };
                
                this.quickQuestions = Object.keys(this.predefinedQA);
                
                this.init();
            }

            init() {
                this.bindEvents();
                this.checkAPIStatus();
            }

            checkAPIStatus() {
                if (this.GEMINI_API_KEY && this.GEMINI_API_KEY !== 'YOUR_GEMINI_API_KEY_HERE') {
                    console.log('Gemini API enabled with key:', this.GEMINI_API_KEY.substring(0, 10) + '...');
                } else {
                    console.warn('Gemini API key not configured properly. Using offline mode only.');
                }
            }

            bindEvents() {
                const toggle = document.getElementById('chatbotToggle');
                const close = document.getElementById('chatbotClose');
                const send = document.getElementById('chatbotSend');
                const input = document.getElementById('chatbotInput');

                if (toggle) toggle.addEventListener('click', () => this.toggleChat());
                if (close) close.addEventListener('click', () => this.closeChat());
                if (send) send.addEventListener('click', () => this.sendMessage());
                
                if (input) {
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            this.sendMessage();
                        }
                    });

                    // Auto-resize textarea
                    input.addEventListener('input', () => {
                        input.style.height = 'auto';
                        input.style.height = Math.min(input.scrollHeight, 100) + 'px';
                    });
                }
            }

            toggleChat() {
                const window = document.getElementById('chatbotWindow');
                if (!window) return;
                
                this.isOpen = !this.isOpen;
                
                if (this.isOpen) {
                    window.classList.add('active');
                    const input = document.getElementById('chatbotInput');
                    if (input) input.focus();
                    
                    // Show welcome message only when first opened
                    if (!this.hasShownWelcome) {
                        setTimeout(() => {
                            this.addWelcomeMessage();
                            this.hasShownWelcome = true;
                        }, 300);
                    }
                } else {
                    window.classList.remove('active');
                }
            }

            closeChat() {
                const window = document.getElementById('chatbotWindow');
                if (window) {
                    window.classList.remove('active');
                    this.isOpen = false;
                }
            }

            addWelcomeMessage() {
                const welcomeMsg = "Ayubowan! Welcome to WheelzAI Ads Assistant! 🇱🇰\n\nI'm here to help you manage your vehicle advertisements and maximize your selling success. I can assist with:\n\n• Creating effective advertisements\n• Pricing strategies and market insights\n• Photography tips for better visibility\n• Managing your listings\n• Sri Lankan vehicle market information\n\nChoose a quick question below or ask me anything:";
                this.addMessage('bot', welcomeMsg);
                
                // Add questions immediately after welcome message
                setTimeout(() => {
                    this.addQuickQuestions();
                }, 100);
            }

            addMessage(sender, text, isHtml = false) {
                const messagesContainer = document.getElementById('chatbotMessages');
                if (!messagesContainer) return;

                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                
                if (isHtml) {
                    messageDiv.innerHTML = text;
                } else {
                    messageDiv.textContent = text;
                }
                
                this.messages.push({ sender, text, timestamp: new Date() });
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            addQuickQuestions() {
                const messagesContainer = document.getElementById('chatbotMessages');
                
                if (!messagesContainer) {
                    console.error('Messages container not found');
                    return;
                }
                
                // Create a visible container for the questions
                const questionsContainer = document.createElement('div');
                questionsContainer.className = 'quick-questions';
                
                // Add header
                const headerDiv = document.createElement('div');
                headerDiv.className = 'quick-questions-header';
                headerDiv.textContent = '💡 Advertisement Help Topics - Click any for instant guidance:';
                questionsContainer.appendChild(headerDiv);
                
                // Add each question as a clickable button
                this.quickQuestions.forEach((question, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'quick-question';
                    btn.textContent = `${index + 1}. ${question}`;
                    
                    btn.addEventListener('click', () => {
                        this.handleQuickQuestion(question);
                    });
                    
                    questionsContainer.appendChild(btn);
                });
                
                messagesContainer.appendChild(questionsContainer);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                console.log('Quick questions added successfully');
            }

            handleQuickQuestion(question) {
                // Add user message
                this.addMessage('user', question);
                
                // Show typing indicator
                this.showTypingIndicator();
                
                setTimeout(() => {
                    this.hideTypingIndicator();
                    const answer = this.predefinedQA[question];
                    this.addMessage('bot', answer);
                }, 1000);
            }

            showTypingIndicator() {
                const indicator = document.getElementById('typingIndicator');
                const messagesContainer = document.getElementById('chatbotMessages');
                if (indicator && messagesContainer) {
                    indicator.style.display = 'flex';
                    messagesContainer.appendChild(indicator);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
            }

            hideTypingIndicator() {
                const indicator = document.getElementById('typingIndicator');
                if (indicator) {
                    indicator.style.display = 'none';
                }
            }

            async sendMessage() {
                const input = document.getElementById('chatbotInput');
                const sendButton = document.getElementById('chatbotSend');
                if (!input) return;

                const message = input.value.trim();
                if (!message) return;
                
                // Disable input during processing
                if (sendButton) sendButton.disabled = true;
                input.disabled = true;
                
                // Add user message
                this.addMessage('user', message);
                this.conversationHistory.push({ role: "user", content: message });
                
                input.value = '';
                input.style.height = 'auto';
                
                // Show typing indicator
                this.showTypingIndicator();
                
                try {
                    // Try to get response from Gemini API first
                    const response = await this.getGeminiResponse(message);
                    this.hideTypingIndicator();
                    this.addMessage('bot', response + " <span class='gemini-badge'>Gemini</span>", true);
                    this.conversationHistory.push({ role: "assistant", content: response });
                } catch (error) {
                    console.log('Gemini API error, using offline response:', error.message);
                    this.hideTypingIndicator();
                    
                    // Use enhanced fallback responses
                    const fallbackResponse = this.getEnhancedResponse(message);
                    this.addMessage('bot', fallbackResponse);
                    
                    // Show error message for API issues
                    if (this.GEMINI_API_KEY && this.GEMINI_API_KEY !== 'YOUR_GEMINI_API_KEY_HERE') {
                        this.addErrorMessage("Gemini API temporarily unavailable. Using offline responses.");
                    }
                }
                
                // Re-enable input
                if (sendButton) sendButton.disabled = false;
                input.disabled = false;
                input.focus();
            }

            async getGeminiResponse(message) {
                if (!this.GEMINI_API_KEY || this.GEMINI_API_KEY === 'YOUR_GEMINI_API_KEY_HERE') {
                    throw new Error('API key not configured properly');
                }

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${this.GEMINI_API_KEY}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: `You are WheelzAI Ads Assistant, helping users with their vehicle advertisement management and Sri Lankan vehicle market information. You specialize in:

- Creating effective vehicle advertisements
- Pricing strategies and market insights for Sri Lankan vehicle market  
- Photography tips for better ad visibility
- Advertisement management and optimization
- Sri Lankan vehicle market trends and popular brands
- Selling strategies to attract more buyers

Context: The user is currently on their Advertisements dashboard page where they can:
- View all their posted vehicle advertisements  
- Filter ads by status (active, pending, sold)
- Edit, delete, or view details of their listings
- Track advertisement performance and statistics
- Post new vehicle advertisements

Current user is managing their vehicle advertisements on WheelzAI platform in Sri Lanka.

User question: ${message}

Please provide helpful, specific guidance related to advertisement management, vehicle selling strategies, or Sri Lankan vehicle market insights. Keep responses practical and actionable (under 300 words).`
                                }]
                            }],
                            generationConfig: {
                                temperature: 0.7,
                                topK: 40,
                                topP: 0.95,
                                maxOutputTokens: 400,
                            }
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        console.error('Gemini API Error Details:', errorData);
                        throw new Error(`Gemini API error: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
                    }

                    const data = await response.json();
                    
                    if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts[0]) {
                        return data.candidates[0].content.parts[0].text;
                    } else {
                        console.error('Invalid Gemini response format:', data);
                        throw new Error('Invalid response format from Gemini API');
                    }
                } catch (error) {
                    console.error('Gemini API request failed:', error);
                    throw error;
                }
            }

            getEnhancedResponse(message) {
                const lowerMessage = message.toLowerCase();
                
                // Check for exact matches with predefined questions
                for (const [question, answer] of Object.entries(this.predefinedQA)) {
                    if (lowerMessage.includes(question.toLowerCase().substring(0, 15))) {
                        return answer;
                    }
                }
                
                // Advertisement-specific responses
                if (lowerMessage.includes('post') || lowerMessage.includes('create') || lowerMessage.includes('new ad')) {
                    return this.predefinedQA["How to post a new vehicle advertisement"];
                }
                
                if (lowerMessage.includes('photo') || lowerMessage.includes('picture') || lowerMessage.includes('image')) {
                    return this.predefinedQA["Best practices for vehicle photography"];
                }
                
                if (lowerMessage.includes('price') || lowerMessage.includes('pricing') || lowerMessage.includes('cost')) {
                    return this.predefinedQA["How to price my vehicle competitively"];
                }
                
                if (lowerMessage.includes('manage') || lowerMessage.includes('track') || lowerMessage.includes('dashboard')) {
                    return this.predefinedQA["How to manage and track my advertisements"];
                }
                
                if (lowerMessage.includes('visibility') || lowerMessage.includes('buyers') || lowerMessage.includes('sell faster')) {
                    return this.predefinedQA["How to improve my ad visibility and get more buyers"];
                }
                
                if (lowerMessage.includes('popular') || lowerMessage.includes('brands') || lowerMessage.includes('market')) {
                    return this.predefinedQA["Popular car brands and pricing in Sri Lanka"];
                }
                
                // Vehicle brand specific queries
                if (lowerMessage.includes('toyota')) {
                    return "Toyota is the most popular brand in Sri Lanka! 🚗\n\n**Popular Models:**\n• **Vitz:** LKR 5.5-6.5M (compact, city driving)\n• **Aqua:** LKR 6.5-8.5M (hybrid, fuel efficient)\n• **Prius:** LKR 7-12M (premium hybrid)\n• **Allion:** LKR 6-9M (sedan, family car)\n\n**Selling Tips:**\n• Toyota vehicles have excellent resale value\n• Emphasize service history and original parts\n• Hybrid models command 15-20% premium\n• Include fuel economy figures in your ad";
                }
                
                if (lowerMessage.includes('honda')) {
                    return "Honda vehicles are highly sought after! 🏆\n\n**Popular Models:**\n• **Fit:** LKR 5.8-6.8M (versatile, reliable)\n• **Grace:** LKR 7-9M (hybrid sedan)\n• **Civic:** LKR 8-12M (premium sedan)\n• **Vezel:** LKR 8-14M (crossover SUV)\n\n**Selling Advantages:**\n• Known for reliability and build quality\n• Strong demand in Sri Lankan market\n• Good fuel efficiency attracts buyers\n• Emphasize Honda's reputation in your listing";
                }
                
                // Edit/Delete queries
                if (lowerMessage.includes('edit') || lowerMessage.includes('update') || lowerMessage.includes('change')) {
                    return "To edit your advertisement:\n\n✏️ **Steps:**\n1. Find your ad in the list above\n2. Click the 'Edit' button on your ad card\n3. Update any information (photos, price, description)\n4. Save your changes\n\n💡 **What you can update:**\n• Photos and descriptions\n• Asking price and negotiation settings\n• Contact information\n• Vehicle condition notes\n• Additional features or modifications\n\n🔄 **Pro tip:** Regular updates boost your ad's visibility!";
                }
                
                if (lowerMessage.includes('delete') || lowerMessage.includes('remove')) {
                    return "To delete an advertisement:\n\n🗑️ **Steps:**\n1. Find the ad you want to remove\n2. Click the 'Delete' button (red)\n3. Confirm deletion in the popup\n\n⚠️ **Important:**\n• Deletion is permanent and cannot be undone\n• Consider editing instead if you just need to update info\n• Mark as 'Sold' instead if the vehicle was sold\n\n💡 **Alternative:** You can also mark ads as inactive if you want to temporarily hide them.";
                }
                
                // Status queries
                if (lowerMessage.includes('pending') || lowerMessage.includes('approval')) {
                    return "About pending advertisements:\n\n⏳ **Pending Status Means:**\n• Your ad is under review by our team\n• Usually takes 2-24 hours for approval\n• We check for quality and completeness\n\n✅ **To speed up approval:**\n• Ensure all required fields are filled\n• Upload clear, high-quality photos\n• Provide accurate vehicle information\n• Include proper contact details\n\n❌ **Common rejection reasons:**\n• Blurry or inappropriate photos\n• Incomplete vehicle information\n• Suspicious pricing (too low/high)\n• Invalid contact information";
                }
                
                // Greeting patterns
                if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey') || lowerMessage.includes('ayubowan')) {
                    return "Ayubowan! 🙏 I'm your WheelzAI Ads Assistant! I'm here to help you create, manage, and optimize your vehicle advertisements. Whether you need help with pricing, photography, or getting more buyers, I'm here to help. What would you like to know?";
                }
                
                // Thank you
                if (lowerMessage.includes('thank')) {
                    return "You're very welcome! 😊 I'm here to help you succeed with your vehicle advertisements. Feel free to ask about posting tips, pricing strategies, photo techniques, or anything else related to selling your vehicle on WheelzAI!";
                }
                
                // Default response with advertisement-focused suggestions
                return "I can help you with your WheelzAI advertisements! Try asking about:\n\n📝 **Creating Better Ads:**\n• \"How to post a new vehicle advertisement\"\n• \"Best practices for vehicle photography\"\n• \"How to price my vehicle competitively\"\n\n📈 **Growing Your Success:**\n• \"How to get more buyers for my ad\"\n• \"How to manage my advertisements\"\n• \"Popular car brands in Sri Lanka\"\n\n🔧 **Managing Listings:**\n• \"How to edit my advertisement\"\n• \"Why is my ad pending approval\"\n• \"How to delete an advertisement\"\n\nWhat would you like to know?";
            }

            addErrorMessage(message) {
                const messagesContainer = document.getElementById('chatbotMessages');
                if (!messagesContainer) return;
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message-chatbot';
                errorDiv.textContent = message;
                messagesContainer.appendChild(errorDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }

        // Session Manager
        class SessionManager {
            constructor() {
                this.auth = auth;
                this.currentUser = null;
                this.userProfile = null;
            }

            async init() {
                return new Promise((resolve) => {
                    onAuthStateChanged(this.auth, async (user) => {
                        this.currentUser = user;
                        if (user) {
                            console.log('User authenticated:', user.uid);
                            sessionStorage.setItem('wheelzai_user', JSON.stringify({
                                uid: user.uid,
                                email: user.email,
                                displayName: user.displayName
                            }));
                            resolve(user);
                        } else {
                            console.log('User not authenticated, redirecting...');
                            this.redirectToLogin();
                        }
                    });
                });
            }

            redirectToLogin() {
                sessionStorage.clear();
                window.location.href = 'index.html';
            }
        }

        // Advertisements Manager
        class AdvertisementsManager {
            constructor(sessionManager) {
                this.sessionManager = sessionManager;
                this.allAds = [];
                this.filteredAds = [];
                this.currentFilter = 'all';
                this.searchTerm = '';
            }

            async init() {
                console.log('Current user:', this.sessionManager.currentUser);
                console.log('Current user UID:', this.sessionManager.currentUser?.uid);
                
                await this.loadAdvertisements();
                this.setupEventListeners();
                this.showAdsPage();
            }

            async loadAdvertisements() {
                try {
                    const userId = this.sessionManager.currentUser.uid;
                    console.log('Loading advertisements for user:', userId);

                    let querySnapshot;
                    
                    try {
                        const adsRef = collection(db, 'Advertisements');
                        const q = query(adsRef, where('userId', '==', userId));
                        querySnapshot = await getDocs(q);
                        console.log('Successfully queried with userId filter');
                    } catch (indexError) {
                        console.log('Index error, trying alternative approach:', indexError);
                        
                        try {
                            const adsRef = collection(db, 'Advertisements');
                            querySnapshot = await getDocs(adsRef);
                            console.log('Got all documents, will filter client-side');
                        } catch (fallbackError) {
                            console.error('All query methods failed:', fallbackError);
                            throw fallbackError;
                        }
                    }
                    
                    this.allAds = [];
                    querySnapshot.forEach((doc) => {
                        const adData = doc.data();
                        console.log('Document data:', adData);
                        
                        if (!adData.userId || adData.userId === userId) {
                            this.allAds.push({
                                id: doc.id,
                                ...adData,
                                createdAt: adData.createdAt ? 
                                    (adData.createdAt.seconds ? new Date(adData.createdAt.seconds * 1000) : new Date(adData.createdAt)) 
                                    : new Date()
                            });
                        }
                    });

                    // Sort by creation date (newest first)
                    this.allAds.sort((a, b) => b.createdAt - a.createdAt);

                    console.log(`Loaded ${this.allAds.length} advertisements for user ${userId}`);
                    console.log('All ads:', this.allAds);
                    
                    this.updateStatistics();
                    this.filterAndDisplayAds();

                } catch (error) {
                    console.error('Error loading advertisements:', error);
                    this.allAds = [];
                    this.updateStatistics();
                    this.showEmptyState();
                }
            }

            updateStatistics() {
                const stats = {
                    total: this.allAds.length,
                    active: this.allAds.filter(ad => ad.status === 'active').length,
                    pending: this.allAds.filter(ad => ad.status === 'pending').length,
                    sold: this.allAds.filter(ad => ad.status === 'sold').length
                };

                document.getElementById('total-ads').textContent = stats.total;
                document.getElementById('active-ads').textContent = stats.active;
                document.getElementById('pending-ads').textContent = stats.pending;
                document.getElementById('sold-ads').textContent = stats.sold;
            }

            filterAndDisplayAds() {
                this.filteredAds = this.allAds.filter(ad => {
                    const matchesFilter = this.currentFilter === 'all' || ad.status === this.currentFilter;
                    const matchesSearch = this.searchTerm === '' || 
                        `${ad.make} ${ad.model}`.toLowerCase().includes(this.searchTerm.toLowerCase()) ||
                        ad.listingId?.toLowerCase().includes(this.searchTerm.toLowerCase());
                    
                    return matchesFilter && matchesSearch;
                });

                if (this.filteredAds.length === 0) {
                    this.showEmptyState();
                } else {
                    this.displayAds();
                }
            }

            displayAds() {
                const adsGrid = document.getElementById('ads-grid');
                const emptyState = document.getElementById('empty-state');
                
                emptyState.style.display = 'none';
                adsGrid.style.display = 'grid';
                adsGrid.innerHTML = '';

                this.filteredAds.forEach(ad => {
                    const adCard = this.createAdCard(ad);
                    adsGrid.appendChild(adCard);
                });
            }

            createAdCard(ad) {
                const card = document.createElement('div');
                card.className = 'ad-card';
                
                const statusClass = `status-${ad.status || 'active'}`;
                
                const formatLKR = (amount) => {
                    if (amount >= 10000000) {
                        return `LKR ${(amount / 10000000).toFixed(1)}Cr`;
                    } else if (amount >= 100000) {
                        return `LKR ${(amount / 100000).toFixed(1)}L`;
                    } else {
                        return `LKR ${amount?.toLocaleString() || 'N/A'}`;
                    }
                };
                
                const price = ad.askingPrice ? formatLKR(ad.askingPrice) : 'Price not set';
                const createdDate = ad.createdAt ? ad.createdAt.toLocaleDateString() : 'Unknown date';
                const vehicleTitle = `${ad.year || ''} ${ad.make || ''} ${ad.model || ''}`.trim() || 'Vehicle Advertisement';

                const firstPhoto = ad.photos && ad.photos.length > 0 ? ad.photos[0] : null;

                card.innerHTML = `
                    <div class="ad-status ${statusClass}">${(ad.status || 'active').toUpperCase()}</div>
                    <div class="ad-image">
                        ${firstPhoto ? `<img src="${firstPhoto}" alt="${vehicleTitle}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">` : ''}
                        <div style="display: ${firstPhoto ? 'none' : 'flex'}; align-items: center; justify-content: center; width: 100%; height: 100%; color: #64748b; font-size: 48px;">🚗</div>
                    </div>
                    <div class="ad-title">${vehicleTitle}</div>
                    <div class="ad-price">${price}</div>
                    <div class="ad-details">
                        <div class="ad-detail-item">
                            <span class="ad-detail-label">Make:</span>
                            <span class="ad-detail-value">${ad.make || 'N/A'}</span>
                        </div>
                        <div class="ad-detail-item">
                            <span class="ad-detail-label">Model:</span>
                            <span class="ad-detail-value">${ad.model || 'N/A'}</span>
                        </div>
                        <div class="ad-detail-item">
                            <span class="ad-detail-label">Year:</span>
                            <span class="ad-detail-value">${ad.year || 'N/A'}</span>
                        </div>
                        <div class="ad-detail-item">
                            <span class="ad-detail-label">Mileage:</span>
                            <span class="ad-detail-value">${ad.mileage ? ad.mileage.toLocaleString() + ' km' : 'N/A'}</span>
                        </div>
                        <div class="ad-detail-item">
                            <span class="ad-detail-label">Condition:</span>
                            <span class="ad-detail-value">${ad.condition || 'N/A'}</span>
                        </div>
                        <div class="ad-detail-item">
                            <span class="ad-detail-label">Listing ID:</span>
                            <span class="ad-detail-value">${ad.listingId || 'N/A'}</span>
                        </div>
                        <div class="ad-detail-item">
                            <span class="ad-detail-label">Posted:</span>
                            <span class="ad-detail-value">${createdDate}</span>
                        </div>
                        <div class="ad-detail-item">
                            <span class="ad-detail-label">AI Estimate:</span>
                            <span class="ad-detail-value">${ad.aiEstimate || 'N/A'}</span>
                        </div>
                    </div>
                    <div class="ad-actions">
                        <button class="btn btn-secondary" onclick="viewAd('${ad.id}')">View Details</button>
                        <button class="btn btn-primary" onclick="editAd('${ad.id}')">Edit</button>
                        <button class="btn btn-danger" onclick="deleteAd('${ad.id}')">Delete</button>
                    </div>
                `;

                return card;
            }

            showEmptyState() {
                const adsGrid = document.getElementById('ads-grid');
                const emptyState = document.getElementById('empty-state');
                
                adsGrid.style.display = 'none';
                emptyState.style.display = 'block';

                const messageElement = emptyState.querySelector('.empty-state-message');
                if (this.currentFilter !== 'all') {
                    messageElement.textContent = `No ${this.currentFilter} advertisements found.`;
                } else if (this.searchTerm) {
                    messageElement.textContent = `No advertisements found matching "${this.searchTerm}".`;
                } else {
                    messageElement.textContent = "You haven't posted any vehicle advertisements yet. Start by posting your first ad!";
                }
            }

            setupEventListeners() {
                const filterBtns = document.querySelectorAll('.filter-btn');
                filterBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        filterBtns.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        
                        this.currentFilter = btn.dataset.filter;
                        this.filterAndDisplayAds();
                    });
                });

                const searchInput = document.getElementById('search-input');
                searchInput.addEventListener('input', (e) => {
                    this.searchTerm = e.target.value;
                    this.filterAndDisplayAds();
                });
            }

            showAdsPage() {
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('ads-content').style.display = 'block';
            }
        }

        // Global functions for ad actions
        window.viewAd = function(adId) {
            const ad = window.adsManager.allAds.find(a => a.id === adId);
            if (ad) {
                showVehicleModal(ad);
            }
        };

        window.editAd = function(adId) {
            console.log('Editing advertisement:', adId);
            window.location.href = `edit_ad.html?id=${adId}`;
        };

        window.deleteAd = async function(adId) {
            if (confirm('Are you sure you want to delete this advertisement? This action cannot be undone.')) {
                try {
                    await window.deleteDoc(window.doc(window.db, 'Advertisements', adId));
                    alert('Advertisement deleted successfully');
                    window.location.reload();
                } catch (error) {
                    console.error('Error deleting ad:', error);
                    alert('Error deleting advertisement. Please try again.');
                }
            }
        };

        // Enhanced Modal functions
        window.showVehicleModal = function(ad) {
            const modal = document.getElementById('vehicle-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalSubtitle = document.getElementById('modal-subtitle');
            const modalContent = document.getElementById('modal-content');

            const formatLKR = (amount) => {
                if (!amount || isNaN(amount)) return 'Price not set';
                if (amount >= 10000000) {
                    return `LKR ${(amount / 10000000).toFixed(1)}Cr`;
                } else if (amount >= 100000) {
                    return `LKR ${(amount / 100000).toFixed(1)}L`;
                } else {
                    return `LKR ${amount.toLocaleString()}`;
                }
            };

            const vehicleTitle = `${ad.year || ''} ${ad.make || ''} ${ad.model || ''}`.trim() || 'Vehicle Advertisement';
            const price = formatLKR(ad.askingPrice);

            modalTitle.textContent = vehicleTitle;
            modalSubtitle.innerHTML = `
                <span>📅</span>
                <span>Listed on ${ad.createdAt ? ad.createdAt.toLocaleDateString() : 'Unknown date'}</span>
            `;

            // Reset current image index
            currentMainImage = 0;

            // Create enhanced image gallery
            let imageGalleryHTML = '';
            if (ad.photos && ad.photos.length > 0) {
                imageGalleryHTML = `
                    <div class="image-gallery-container">
                        <div class="main-image-container">
                            <img src="${ad.photos[0]}" alt="${vehicleTitle}" class="main-image" id="main-image" 
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="main-image-placeholder" style="display: none;">
                                <span>🚗</span>
                                <div class="text">Image not available</div>
                            </div>
                        </div>
                        ${ad.photos.length > 1 ? `
                            <div class="thumbnail-container">
                                ${ad.photos.map((photo, index) => `
                                    <div class="thumbnail ${index === 0 ? 'active' : ''}" onclick="changeMainImage(${index})">
                                        <img src="${photo}" alt="Photo ${index + 1}" 
                                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                        <div class="thumbnail-placeholder" style="display: none;">📷</div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            } else {
                imageGalleryHTML = `
                    <div class="image-gallery-container">
                        <div class="main-image-container">
                            <div class="main-image-placeholder">
                                <span>🚗</span>
                                <div class="text">No photos available</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            modalContent.innerHTML = `
                ${imageGalleryHTML}
                
                <div class="price-section">
                    <div class="price-main">${price}</div>
                    <div class="price-estimate">AI Estimate: ${ad.aiEstimate || 'Not available'}</div>
                    <div class="price-negotiable">${ad.negotiable ? '💬 Open to negotiation' : '💎 Firm price'}</div>
                </div>

                <div class="details-container">
                    <div class="detail-section">
                        <h3>
                            <span>🚗</span>
                            Vehicle Information
                        </h3>
                        <div class="detail-item">
                            <span class="detail-label">Make</span>
                            <span class="detail-value">${ad.make || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Model</span>
                            <span class="detail-value">${ad.model || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Year</span>
                            <span class="detail-value">${ad.year || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Mileage</span>
                            <span class="detail-value">${ad.mileage ? ad.mileage.toLocaleString() + ' km' : 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Body Type</span>
                            <span class="detail-value">${ad.bodyType || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Fuel Type</span>
                            <span class="detail-value">${ad.fuelType || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Transmission</span>
                            <span class="detail-value">${ad.transmission || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Engine Capacity</span>
                            <span class="detail-value">${ad.engineCapacity ? ad.engineCapacity + ' cc' : 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Condition</span>
                            <span class="detail-value" style="text-transform: capitalize;">${ad.condition || 'N/A'}</span>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h3>
                            <span>📋</span>
                            Listing Information
                        </h3>
                        <div class="detail-item">
                            <span class="detail-label">Listing ID</span>
                            <span class="detail-value">${ad.listingId || ad.id.substring(0, 8)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Status</span>
                            <span class="detail-value" style="text-transform: capitalize;">${ad.status || 'Active'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Posted Date</span>
                            <span class="detail-value">${ad.createdAt ? ad.createdAt.toLocaleDateString() : 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Last Updated</span>
                            <span class="detail-value">${ad.updatedAt ? new Date(ad.updatedAt.seconds * 1000).toLocaleDateString() : 'Never'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Accident History</span>
                            <span class="detail-value" style="text-transform: capitalize;">${ad.accidentHistory || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Service History</span>
                            <span class="detail-value" style="text-transform: capitalize;">${ad.serviceHistory || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Photos</span>
                            <span class="detail-value">${ad.photos ? ad.photos.length : 0} uploaded</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Documents</span>
                            <span class="detail-value">${ad.documents ? Object.keys(ad.documents).length : 0} uploaded</span>
                        </div>
                    </div>
                </div>

                ${ad.additionalNotes ? `
                    <div class="notes-section">
                        <h3>
                            <span>📝</span>
                            Additional Notes
                        </h3>
                        <div class="notes-text">${ad.additionalNotes}</div>
                    </div>
                ` : ''}

                <div class="contact-section">
                    <h3>
                        <span>📞</span>
                        Contact Information
                    </h3>
                    <div class="contact-grid">
                        <div class="contact-info">
                            <div class="contact-item">
                                <span class="contact-label">👤 Name:</span>
                                <span class="contact-value">${ad.sellerName || 'Not provided'}</span>
                            </div>
                            <div class="contact-item">
                                <span class="contact-label">📧 Email:</span>
                                <span class="contact-value">${ad.email || 'Not provided'}</span>
                            </div>
                            <div class="contact-item">
                                <span class="contact-label">📱 Phone:</span>
                                <span class="contact-value">${ad.phoneNumber || 'Not provided'}</span>
                            </div>
                            ${ad.whatsappNumber ? `
                                <div class="contact-item">
                                    <span class="contact-label">💬 WhatsApp:</span>
                                    <span class="contact-value">${ad.whatsappNumber}</span>
                                </div>
                            ` : ''}
                        </div>
                        <div>
                            <div style="font-weight: 600; color: #1e293b; margin-bottom: 12px;">Preferred Contact Methods:</div>
                            <div class="contact-methods">
                                ${ad.contactMethods && ad.contactMethods.length > 0 ? 
                                    ad.contactMethods.map(method => `<span class="contact-method">${method}</span>`).join('') :
                                    '<span class="contact-method">Any method</span>'
                                }
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Store current ad photos globally for navigation
            window.currentAdPhotos = ad.photos || [];

            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // Add show class for animation
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
        };

        window.closeModal = function() {
            const modal = document.getElementById('vehicle-modal');
            modal.classList.remove('show');
            
            setTimeout(() => {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                currentMainImage = 0;
                window.currentAdPhotos = [];
            }, 300);
        };

        window.changeMainImage = function(imageIndex) {
            if (!window.currentAdPhotos || window.currentAdPhotos.length === 0) return;
            
            currentMainImage = imageIndex;
            const mainImage = document.getElementById('main-image');
            
            if (mainImage && window.currentAdPhotos[imageIndex]) {
                mainImage.src = window.currentAdPhotos[imageIndex];
                
                // Update thumbnail active states
                const thumbnails = document.querySelectorAll('.thumbnail');
                thumbnails.forEach((thumb, index) => {
                    if (index === imageIndex) {
                        thumb.classList.add('active');
                    } else {
                        thumb.classList.remove('active');
                    }
                });
            }
        };

        // Keyboard navigation for modal
        window.addEventListener('keydown', function(event) {
            const modal = document.getElementById('vehicle-modal');
            
            if (modal.style.display === 'flex') {
                if (event.key === 'Escape') {
                    closeModal();
                } else if (event.key === 'ArrowLeft' && window.currentAdPhotos && currentMainImage > 0) {
                    changeMainImage(currentMainImage - 1);
                } else if (event.key === 'ArrowRight' && window.currentAdPhotos && currentMainImage < window.currentAdPhotos.length - 1) {
                    changeMainImage(currentMainImage + 1);
                }
            }
        });

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('vehicle-modal');
            if (event.target === modal) {
                closeModal();
            }
        });

        // Initialize everything
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('Initializing advertisements page with chatbot...');
                
                const sessionManager = new SessionManager();
                await sessionManager.init();

                const adsManager = new AdvertisementsManager(sessionManager);
                window.adsManager = adsManager;
                await adsManager.init();

                // Initialize the chatbot
                window.enhancedWheelzAIChatbot = new EnhancedWheelzAIChatbot();

                console.log('Advertisements page with chatbot initialized successfully');
            } catch (error) {
                console.error('Error initializing advertisements page:', error);
                alert('Error loading advertisements page. Please try again.');
                window.location.href = 'dashboard.html';
            }
        });
    </script>
</body>
</html>